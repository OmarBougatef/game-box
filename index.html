<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Love Arcade - Final Version</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        :root { --bg: #0f0f1a; --gold: #ffd700; --pink: #ff0055; --blue: #00d2ff; }
        
        * { box-sizing: border-box; touch-action: none; user-select: none; -webkit-user-select: none; }
        
        body {
            margin: 0; padding: 0;
            background-color: var(--bg);
            color: #fff;
            font-family: 'Press Start 2P', cursive;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100vh; overflow: hidden;
        }

        #game-wrapper {
            position: relative;
            width: 100%; max-width: 400px;
            height: 100%; max-height: 800px;
            display: flex; flex-direction: column;
        }

        /* --- ZONE DE JEU --- */
        canvas {
            background: #000;
            display: block;
            width: 100%;
            flex-grow: 1; /* Prend toute la place dispo */
            image-rendering: pixelated;
            border-bottom: 2px solid var(--pink);
        }

        /* --- UI & HUD --- */
        #ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; display: flex; flex-direction: column;
        }
        
        .top-bar {
            padding: 10px; display: flex; justify-content: space-between;
            font-size: 10px; color: var(--gold); text-shadow: 1px 1px #000;
            background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent);
        }

        /* --- MENUS --- */
        .screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 15, 26, 0.98);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 100; pointer-events: auto;
        }
        .hidden { display: none !important; }

        h1 { font-size: 16px; color: var(--pink); margin-bottom: 20px; text-align: center; line-height: 1.5; }
        
        .grid-menu { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 80%; }
        .btn-game {
            background: #222; border: 2px solid #fff; color: #fff;
            padding: 15px 5px; font-family: inherit; font-size: 9px;
            cursor: pointer; text-align: center; display: flex; flex-direction: column; align-items: center;
        }
        .btn-game span { font-size: 20px; margin-bottom: 5px; }
        .btn-game:active { background: var(--pink); transform: scale(0.95); }

        .btn-main {
            margin-top: 20px; padding: 15px 30px; background: var(--gold); color: #000;
            border: none; font-family: inherit; font-size: 10px; cursor: pointer;
        }

        /* --- CONTROLS --- */
        #controls-area {
            height: 120px; background: #111;
            display: flex; align-items: center; justify-content: center;
            border-top: 2px solid #333; flex-shrink: 0;
        }

        /* 2-BUTTONS (Pour les jeux simples) */
        #ctrl-2btn { width: 100%; height: 100%; display: flex; }
        .btn-half { flex: 1; display: flex; align-items: center; justify-content: center; border-right: 1px solid #333; font-size: 10px; color: #555; }
        .btn-half:active { background: #222; color: #fff; }

        /* D-PAD (Pour le labyrinthe) */
        #ctrl-dpad {
            display: grid; grid-template-columns: 50px 50px 50px; grid-template-rows: 50px 50px; gap: 5px;
        }
        .d-btn { background: #333; border-radius: 5px; display: flex; align-items: center; justify-content: center; font-size: 20px; color: #fff; box-shadow: 0 4px 0 #000; }
        .d-btn:active { transform: translateY(4px); box-shadow: 0 0 0 #000; background: var(--pink); }

    </style>
</head>
<body>

<div id="game-wrapper">
    <div id="ui-layer">
        <div class="top-bar">
            <span id="score-el">SCORE: 0</span>
            <span id="title-el">MENU</span>
        </div>
    </div>

    <canvas id="cvs"></canvas>

    <div id="controls-area">
        <div id="ctrl-2btn" class="hidden">
            <div class="btn-half" onpointerdown="Input.left=true" onpointerup="Input.left=false">‚óÄ GAUCHE</div>
            <div class="btn-half" onpointerdown="Input.right=true" onpointerup="Input.right=false">DROITE ‚ñ∂</div>
        </div>
        <div id="ctrl-dpad" class="hidden">
            <div class="d-btn" style="grid-column: 2;" onpointerdown="Input.up=true" onpointerup="Input.up=false">‚ñ≤</div>
            <div class="d-btn" style="grid-column: 1; grid-row: 2;" onpointerdown="Input.left=true" onpointerup="Input.left=false">‚óÄ</div>
            <div class="d-btn" style="grid-column: 2; grid-row: 2;" onpointerdown="Input.down=true" onpointerup="Input.down=false">‚ñº</div>
            <div class="d-btn" style="grid-column: 3; grid-row: 2;" onpointerdown="Input.right=true" onpointerup="Input.right=false">‚ñ∂</div>
        </div>
    </div>

    <div id="screen-menu" class="screen">
        <h1>LOVE ARCADE<br><span style="font-size:10px; color:#fff">Ultimate Edition</span></h1>
        <div class="grid-menu">
            <button class="btn-game" onclick="Game.start('MAZE')"><span>üè∞</span>MAZE</button>
            <button class="btn-game" onclick="Game.start('CATCH')"><span>üçé</span>CATCH</button>
            <button class="btn-game" onclick="Game.start('SHIELD')"><span>üõ°Ô∏è</span>SHIELD</button>
            <button class="btn-game" onclick="Game.start('FLY')"><span>üïäÔ∏è</span>FLY</button>
            <button class="btn-game" onclick="Game.start('KISS')"><span>‚ö°</span>KISS</button>
            <button class="btn-game" onclick="Game.start('JUMP')"><span>üöÄ</span>JUMP</button>
        </div>
    </div>

    <div id="screen-over" class="screen hidden">
        <h1 id="over-title">BRAVO !</h1>
        <p id="over-msg" style="font-size:10px; text-align:center; padding:20px; line-height:1.6; color:#ccc;">...</p>
        <button class="btn-main" onclick="Game.menu()">RETOUR AU MENU</button>
    </div>
</div>

<script>
// --- CONFIG & UTILS ---
const canvas = document.getElementById('cvs');
const ctx = canvas.getContext('2d');
// Fix resolution
const CW = 320;
const CH = 320; // Carr√© parfait pour simplifier
canvas.width = CW; canvas.height = CH;

const Input = { left: false, right: false, up: false, down: false };

// --- ART ---
function drawPrincess(x, y, s) {
    const p = s / 16;
    ctx.fillStyle = '#ffdbac'; ctx.fillRect(x+5*p, y+5*p, 6*p, 4*p); // Visage
    ctx.fillStyle = '#f1c40f'; ctx.fillRect(x+4*p, y+2*p, 8*p, 4*p); // Cheveux
    ctx.fillRect(x+3*p, y+4*p, 2*p, 6*p); ctx.fillRect(x+11*p, y+4*p, 2*p, 6*p);
    ctx.fillStyle = '#ffd700'; ctx.fillRect(x+6*p, y, 4*p, 2*p); // Couronne
    ctx.fillStyle = '#e91e63'; ctx.fillRect(x+5*p, y+10*p, 6*p, 6*p); // Robe haut
    ctx.fillStyle = '#ff69b4'; ctx.fillRect(x+3*p, y+13*p, 10*p, 3*p); // Robe bas
    ctx.fillStyle = '#000'; ctx.fillRect(x+6*p, y+6*p, p, p); ctx.fillRect(x+9*p, y+6*p, p, p); // Yeux
}

// --- GAME ENGINE ---
const Game = {
    mode: null,
    active: false,
    score: 0,
    state: {},
    loopId: null,

    start(mode) {
        this.mode = mode;
        this.active = true;
        this.score = 0;
        this.state = {}; 
        
        // UI RESET
        document.getElementById('screen-menu').classList.add('hidden');
        document.getElementById('screen-over').classList.add('hidden');
        document.getElementById('title-el').innerText = mode;
        
        // INPUT DISPLAY
        if(mode === 'MAZE') {
            document.getElementById('ctrl-2btn').classList.add('hidden');
            document.getElementById('ctrl-dpad').classList.remove('hidden');
        } else {
            document.getElementById('ctrl-2btn').classList.remove('hidden');
            document.getElementById('ctrl-dpad').classList.add('hidden');
        }

        this.init();
        this.loop();
    },

    menu() {
        this.active = false;
        cancelAnimationFrame(this.loopId);
        document.getElementById('screen-menu').classList.remove('hidden');
        document.getElementById('screen-over').classList.add('hidden');
    },

    over(title, msg) {
        this.active = false;
        document.getElementById('over-title').innerText = title;
        document.getElementById('over-msg').innerText = msg;
        document.getElementById('screen-over').classList.remove('hidden');
    },

    init() {
        const s = this.state;
        if(this.mode === 'MAZE') {
            // 0: Chemin, 1: Mur, 2: D√©part, 3: Arriv√©e
            s.map = [
                [1,1,1,1,1,1,1,1,1,1],
                [1,2,0,0,1,0,0,0,0,1],
                [1,1,1,0,1,0,1,1,0,1],
                [1,0,0,0,0,0,1,0,0,1],
                [1,0,1,1,1,0,1,0,1,1],
                [1,0,1,0,0,0,0,0,0,1],
                [1,0,1,0,1,1,1,1,0,1],
                [1,0,0,0,1,3,0,0,0,1],
                [1,1,1,1,1,1,1,1,1,1]
            ];
            s.tileSize = CW / 10;
            s.p = {x: 1, y: 1}; // Case coordonn√©es
            s.moveTimer = 0;
        }
        else if(this.mode === 'CATCH') {
            s.p = CW/2; s.items = []; s.timer = 0;
        }
        else if(this.mode === 'SHIELD') {
            s.angle = 0; s.ennemies = []; s.timer = 0;
        }
        else if(this.mode === 'FLY') {
            s.y = CH/2; s.v = 0; s.walls = []; s.timer = 0;
        }
        else if(this.mode === 'KISS') {
            s.angle = 0; s.target = Math.random()*6; s.speed = 0.05;
        }
        else if(this.mode === 'JUMP') {
            s.p = {x:CW/2, y:CH-50, vx:0, vy:0};
            s.plats = [];
            for(let i=0; i<6; i++) s.plats.push({x:Math.random()*(CW-50), y:i*60, w:50});
        }
    },

    update() {
        const s = this.state;
        
        // --- 1. MAZE (GRID BASED) ---
        if(this.mode === 'MAZE') {
            if(s.moveTimer > 0) s.moveTimer--;
            else {
                let dx = 0, dy = 0;
                if(Input.up) dy = -1;
                else if(Input.down) dy = 1;
                else if(Input.left) dx = -1;
                else if(Input.right) dx = 1;

                if(dx !== 0 || dy !== 0) {
                    let targetX = s.p.x + dx;
                    let targetY = s.p.y + dy;
                    // Collision check avec la grille
                    if(s.map[targetY] && s.map[targetY][targetX] !== 1) {
                        s.p.x = targetX; s.p.y = targetY;
                        s.moveTimer = 8; // Vitesse de d√©placement
                        if(s.map[targetY][targetX] === 3) this.over("GAGN√â !", "Tu as trouv√© ton chemin vers mon coeur !");
                    }
                }
            }
        }

        // --- 2. CATCH ---
        else if(this.mode === 'CATCH') {
            if(Input.left) s.p -= 4; if(Input.right) s.p += 4;
            s.p = Math.max(20, Math.min(CW-20, s.p));
            if(s.timer++ % 30 === 0) s.items.push({x:Math.random()*CW, y:-20});
            s.items.forEach((it, i) => {
                it.y += 3;
                if(it.y > CH-40 && Math.abs(it.x - s.p) < 30) { s.items.splice(i,1); this.score++; }
                else if(it.y > CH) this.over("PERDU", "Un coeur bris√©...");
            });
        }

        // --- 3. SHIELD ---
        else if(this.mode === 'SHIELD') {
            if(Input.left) s.angle -= 0.1; if(Input.right) s.angle += 0.1;
            if(s.timer++ % 40 === 0) {
                let a = Math.random() * Math.PI * 2;
                s.ennemies.push({x:CW/2 + Math.cos(a)*200, y:CH/2 + Math.sin(a)*200, a:a});
            }
            s.ennemies.forEach((e, i) => {
                e.x -= Math.cos(e.a)*2; e.y -= Math.sin(e.a)*2;
                let d = Math.hypot(e.x - CW/2, e.y - CH/2);
                if(d < 40) {
                   // Check Shield Angle
                   let shieldA = s.angle % (Math.PI*2);
                   if(shieldA < 0) shieldA += Math.PI*2;
                   let attackA = Math.atan2(e.y-CH/2, e.x-CW/2); 
                   if(attackA < 0) attackA += Math.PI*2;
                   
                   let diff = Math.abs(shieldA - attackA);
                   if(diff > Math.PI) diff = 2*Math.PI - diff; // Wrap around

                   if(diff < 1) { s.ennemies.splice(i,1); this.score++; } // Blocked
                   else this.over("TOUCH√âE !", "Prot√®ge-toi mieux !");
                }
            });
        }

        // --- 4. FLY ---
        else if(this.mode === 'FLY') {
            s.v += 0.2; s.y += s.v;
            if((Input.left || Input.right) && !s.jumpLock) { s.v = -4; s.jumpLock = true; }
            if(!Input.left && !Input.right) s.jumpLock = false;

            if(s.timer++ % 90 === 0) s.walls.push({x:CW, h:Math.random()*(CH-150)});
            s.walls.forEach((w,i) => {
                w.x -= 2;
                // Collision simple AABB
                if(w.x < 60 && w.x > 20) {
                    if(s.y < w.h || s.y > w.h + 100) this.over("CRASH", "Attention aux murs !");
                }
                if(w.x < -40) { s.walls.splice(i,1); this.score++; }
            });
            if(s.y > CH || s.y < 0) this.over("CHUTE", "Reste dans les airs !");
        }

        // --- 5. KISS ---
        else if(this.mode === 'KISS') {
            s.angle += s.speed;
            if(Input.left || Input.right) {
                if(!s.lock) {
                    s.lock = true;
                    let diff = Math.abs((s.angle%(Math.PI*2)) - s.target);
                    if(diff < 0.5) { this.score++; s.target = Math.random()*6; s.speed += 0.01; }
                    else this.over("RAT√â", "Pas le bon moment !");
                }
            } else s.lock = false;
        }

        // --- 6. JUMP ---
        else if(this.mode === 'JUMP') {
            s.p.vy += 0.2; s.p.y += s.p.vy;
            if(Input.left) s.p.x -= 3; if(Input.right) s.p.x += 3;
            // Wrap around
            if(s.p.x < 0) s.p.x = CW; if(s.p.x > CW) s.p.x = 0;

            s.plats.forEach(pl => {
                if(s.p.vy > 0 && s.p.x > pl.x - 10 && s.p.x < pl.x + pl.w + 10 && Math.abs(s.p.y - pl.y) < 10) {
                    s.p.vy = -6; this.score++;
                }
                pl.y += (s.p.y < CH/2 && s.p.vy < 0) ? -s.p.vy : 0; // Cam√©ra
                if(pl.y > CH) { pl.y = 0; pl.x = Math.random()*(CW-50); }
            });
            if(s.p.y > CH) this.over("TOMBER", "On remonte !");
        }

        document.getElementById('score-el').innerText = "SCORE: " + this.score;
    },

    draw() {
        ctx.fillStyle = '#000'; ctx.fillRect(0,0,CW,CH);
        const s = this.state;

        if(this.mode === 'MAZE') {
            s.map.forEach((row, y) => {
                row.forEach((cell, x) => {
                    if(cell===1) { ctx.fillStyle = '#444'; ctx.fillRect(x*s.tileSize, y*s.tileSize, s.tileSize, s.tileSize); }
                    if(cell===3) { ctx.fillStyle = '#2ecc71'; ctx.fillRect(x*s.tileSize, y*s.tileSize, s.tileSize, s.tileSize); }
                });
            });
            drawPrincess(s.p.x*s.tileSize + 2, s.p.y*s.tileSize + 2, s.tileSize-4);
        }

        else if(this.mode === 'CATCH') {
            s.items.forEach(it => { ctx.font="20px serif"; ctx.fillText("‚ù§Ô∏è", it.x, it.y); });
            drawPrincess(s.p-20, CH-50, 40);
        }

        else if(this.mode === 'SHIELD') {
            drawPrincess(CW/2-20, CH/2-20, 40);
            ctx.strokeStyle = '#00d2ff'; ctx.lineWidth = 4;
            ctx.beginPath(); ctx.arc(CW/2, CH/2, 50, s.angle-1, s.angle+1); ctx.stroke();
            s.ennemies.forEach(e => {
                ctx.fillStyle = 'red'; ctx.beginPath(); ctx.arc(e.x, e.y, 5, 0, Math.PI*2); ctx.fill();
            });
        }

        else if(this.mode === 'FLY') {
            drawPrincess(40, s.y, 30);
            ctx.fillStyle = '#555';
            s.walls.forEach(w => {
                ctx.fillRect(w.x, 0, 40, w.h);
                ctx.fillRect(w.x, w.h+100, 40, CH);
            });
        }

        else if(this.mode === 'KISS') {
            drawPrincess(CW/2-20, CH/2-20, 40);
            ctx.strokeStyle = '#333'; ctx.lineWidth = 10; ctx.beginPath(); ctx.arc(CW/2, CH/2, 80, 0, 7); ctx.stroke();
            ctx.strokeStyle = 'gold'; ctx.beginPath(); ctx.arc(CW/2, CH/2, 80, s.target-0.4, s.target+0.4); ctx.stroke();
            let kx = CW/2 + Math.cos(s.angle)*80; let ky = CH/2 + Math.sin(s.angle)*80;
            ctx.font="20px serif"; ctx.fillText("üíã", kx-10, ky+5);
        }

        else if(this.mode === 'JUMP') {
            ctx.fillStyle = '#ff0055';
            s.plats.forEach(p => ctx.fillRect(p.x, p.y, p.w, 8));
            drawPrincess(s.p.x, s.p.y, 30);
        }
    },

    loop() {
        if(!this.active) return;
        this.update();
        this.draw();
        this.loopId = requestAnimationFrame(() => this.loop());
    }
};
</script>
</body>
</html>
