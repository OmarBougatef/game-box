<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Love Arcade Pro</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        :root { --bg: #0a0a12; --accent: #e94560; --gold: #ffd700; --panel: #16213e; }
        * { box-sizing: border-box; touch-action: none; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: var(--bg); color: #fff; font-family: 'Press Start 2P', cursive; overflow: hidden; }
        .screen { position: absolute; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; background: var(--bg); z-index: 10; padding: 20px; }
        .hidden { display: none !important; }

        /* --- HUB --- */
        .hub-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; max-width: 400px; margin-top: 20px; }
        .game-btn { background: var(--panel); border: 3px solid #fff; padding: 15px 5px; text-align: center; cursor: pointer; font-size: 8px; box-shadow: 4px 4px 0 #000; }
        .game-btn:active { transform: translate(2px, 2px); box-shadow: 1px 1px 0 #000; }
        .game-btn .icon { font-size: 24px; margin-bottom: 10px; display: block; }

        /* --- COMMON UI --- */
        canvas { border: 4px solid #fff; background: #000; max-width: 100%; }
        .ui-top { position: absolute; top: 10px; width: 100%; display: flex; justify-content: space-around; font-size: 10px; pointer-events: none; z-index: 20; }
        .back-btn { margin-top: 15px; padding: 10px; background: #333; color: #fff; border: 2px solid #fff; font-family: inherit; font-size: 8px; }
        
        /* --- D-PAD --- */
        #controls { display: grid; grid-template-columns: 50px 50px 50px; gap: 5px; margin-top: 10px; }
        .ctrl-btn { width: 50px; height: 50px; background: rgba(255,255,255,0.1); border: 1px solid #fff; display: flex; align-items: center; justify-content: center; }

        .heart-beat { font-size: 40px; animation: beat 0.8s infinite alternate; color: var(--accent); }
        @keyframes beat { from { transform: scale(1); } to { transform: scale(1.2); } }
    </style>
</head>
<body>

    <div id="hub-screen" class="screen">
        <div class="heart-beat">‚ù§Ô∏è</div>
        <h1 style="font-size: 14px; text-align: center; color: var(--gold); margin: 20px 0;">LOVE ARCADE PRO</h1>
        <div class="hub-grid">
            <div class="game-btn" onclick="startGame('maze')"><span class="icon">üè∞</span>JOIN ME!</div>
            <div class="game-btn" onclick="startGame('catch')"><span class="icon">üçé</span>CATCH LOVE</div>
            <div class="game-btn" onclick="startGame('shield')"><span class="icon">üõ°Ô∏è</span>SHIELD</div>
            <div class="game-btn" onclick="startGame('fly')"><span class="icon">üïäÔ∏è</span>LOVE FLY</div>
            <div class="game-btn" onclick="startGame('speed')"><span class="icon">‚ö°</span>SPEED KISS</div>
            <div class="game-btn" onclick="startGame('jump')"><span class="icon">üöÄ</span>UP UP!</div>
        </div>
    </div>

    <div id="game-screen" class="screen hidden">
        <div class="ui-top">
            <span>SCORE: <span id="score-val">0</span></span>
            <span>BEST: <span id="best-val">0</span></span>
        </div>
        <canvas id="mainCanvas"></canvas>
        <div id="controls" class="hidden">
            <div class="ctrl-btn" style="grid-column:2" onpointerdown="input('up')">‚ñ≤</div>
            <div class="ctrl-btn" style="grid-column:1" onpointerdown="input('left')">‚óÄ</div>
            <div class="ctrl-btn" style="grid-column:2" onpointerdown="input('down')">‚ñº</div>
            <div class="ctrl-btn" style="grid-column:3" onpointerdown="input('right')">‚ñ∂</div>
        </div>
        <button class="back-btn" onclick="exitGame()">‚¨Ö QUITTER</button>
    </div>

    <div id="modal-screen" class="screen hidden" style="background: rgba(0,0,0,0.9);">
        <h2 id="modal-title" style="color: var(--gold);"></h2>
        <p id="modal-msg" style="text-align: center; font-size: 10px; line-height: 2;"></p>
        <button class="back-btn" onclick="exitGame()">RETOUR AU MENU</button>
    </div>

    <script>
        const canvas = document.getElementById('mainCanvas');
        const ctx = canvas.getContext('2d');
        let currentMode = '';
        let score = 0;
        let best = 0;
        let gameActive = false;
        let entities = [];
        let player = {};
        let frame = 0;

        // --- SPRITE PRINCESSE FANCY ---
        function drawFancyPrincess(c, x, y, size) {
            const s = size / 16;
            const colors = { gold: '#ffd700', hair: '#f1c40f', skin: '#f5cba7', dress: '#fd79a8', dark: '#d63031' };
            c.fillStyle = colors.gold; c.fillRect(x+6*s, y, 4*s, s); // Couronne
            c.fillStyle = colors.hair; c.fillRect(x+4*s, y+2*s, 8*s, 3*s); // Cheveux
            c.fillStyle = colors.skin; c.fillRect(x+5*s, y+5*s, 6*s, 4*s); // Visage
            c.fillStyle = '#000'; c.fillRect(x+6*s, y+6*s, s, s); c.fillRect(x+9*s, y+6*s, s, s); // Yeux
            c.fillStyle = colors.dark; c.fillRect(x+6*s, y+9*s, 4*s, 2*s); // Corsage
            c.fillStyle = colors.dress; c.fillRect(x+4*s, y+11*s, 8*s, 5*s); // Jupe
        }

        // --- NAVIGATION ---
        function startGame(mode) {
            document.getElementById('hub-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            document.getElementById('modal-screen').classList.add('hidden');
            currentMode = mode;
            score = 0;
            frame = 0;
            gameActive = true;
            resize();
            initGame();
            loop();
        }

        function exitGame() {
            gameActive = false;
            document.getElementById('hub-screen').classList.remove('hidden');
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('modal-screen').classList.add('hidden');
        }

        function resize() {
            canvas.width = window.innerWidth - 40;
            canvas.height = window.innerHeight - 250;
        }

        // --- INIT JEUX ---
        function initGame() {
            entities = [];
            const midX = canvas.width / 2;
            const midY = canvas.height / 2;
            document.getElementById('controls').classList.add('hidden');

            if (currentMode === 'maze') {
                document.getElementById('controls').classList.remove('hidden');
                player = { x: 30, y: 30, speed: 4 };
            } else if (currentMode === 'catch') {
                player = { x: midX - 20, y: canvas.height - 60, w: 40 };
            } else if (currentMode === 'shield') {
                player = { x: midX, y: midY, angle: 0 };
            } else if (currentMode === 'fly') {
                player = { x: 50, y: midY, vel: 0, gravity: 0.4, jump: -6 };
            } else if (currentMode === 'speed') {
                player = { target: 0, current: 0, speed: 0.05 };
            } else if (currentMode === 'jump') {
                player = { x: midX, y: canvas.height - 60, velY: 0, velX: 0 };
                for(let i=0; i<6; i++) entities.push({x: Math.random()*canvas.width, y: i*100, w: 60});
            }
        }

        // --- INPUTS ---
        function input(dir) {
            if (currentMode === 'maze') {
                if (dir === 'up') player.y -= 20;
                if (dir === 'down') player.y += 20;
                if (dir === 'left') player.x -= 20;
                if (dir === 'right') player.x += 20;
            }
        }

        window.onpointerdown = (e) => {
            if (!gameActive) return;
            if (currentMode === 'catch') {
                player.x = e.clientX < window.innerWidth / 2 ? Math.max(0, player.x - 40) : Math.min(canvas.width - 40, player.x + 40);
            } else if (currentMode === 'fly') {
                player.vel = player.jump;
            } else if (currentMode === 'shield') {
                player.angle += 0.5;
            } else if (currentMode === 'speed') {
                if (Math.abs(player.current - player.target) < 0.2) { score++; player.target = Math.random() * Math.PI * 2; }
                else gameOver("TROP TARD !", "Tes baisers ont manqu√© leur cible...");
            } else if (currentMode === 'jump') {
                player.velX = e.clientX < window.innerWidth / 2 ? -5 : 5;
            }
        };

        // --- MAIN LOOP ---
        function loop() {
            if (!gameActive) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            frame++;
            document.getElementById('score-val').innerText = score;

            if (currentMode === 'catch') updateCatch();
            else if (currentMode === 'shield') updateShield();
            else if (currentMode === 'fly') updateFly();
            else if (currentMode === 'speed') updateSpeed();
            else if (currentMode === 'jump') updateJump();
            else if (currentMode === 'maze') updateMaze();

            requestAnimationFrame(loop);
        }

        function gameOver(title, msg) {
            gameActive = false;
            document.getElementById('modal-title').innerText = title;
            document.getElementById('modal-msg').innerText = msg;
            document.getElementById('modal-screen').classList.remove('hidden');
        }

        // --- LOGIQUE SPECIFIQUE ---

        function updateCatch() {
            drawFancyPrincess(ctx, player.x, player.y, 40);
            if (frame % 40 === 0) entities.push({ x: Math.random() * (canvas.width - 20), y: -20, s: 3 + score/10 });
            entities.forEach((h, i) => {
                h.y += h.s;
                ctx.fillText("‚ù§Ô∏è", h.x, h.y);
                if (h.y > player.y && h.x > player.x - 20 && h.x < player.x + 40) { entities.splice(i, 1); score++; }
                if (h.y > canvas.height) gameOver("PERDU !", "Un c≈ìur est tomb√©... Score: " + score);
            });
        }

        function updateShield() {
            drawFancyPrincess(ctx, player.x - 20, player.y - 20, 40);
            // Shield
            ctx.strokeStyle = '#3498db'; ctx.lineWidth = 5;
            ctx.beginPath();
            ctx.arc(player.x, player.y, 50, player.angle, player.angle + 1.5);
            ctx.stroke();
            if (frame % 50 === 0) {
                let ang = Math.random() * Math.PI * 2;
                entities.push({ x: player.x + Math.cos(ang)*200, y: player.y + Math.sin(ang)*200, ang: ang });
            }
            entities.forEach((m, i) => {
                m.x -= Math.cos(m.ang) * 2; m.y -= Math.sin(m.ang) * 2;
                ctx.fillStyle = '#ff0000'; ctx.beginPath(); ctx.arc(m.x, m.y, 5, 0, 7); ctx.fill();
                let d = Math.hypot(m.x - player.x, m.y - player.y);
                if (d < 55) {
                    let hitAng = Math.atan2(m.y - player.y, m.x - player.x);
                    let diff = Math.abs(hitAng - (player.angle % (Math.PI*2)));
                    if (d < 20) gameOver("BOOM !", "D√©fense bris√©e...");
                    else if (d < 55) { entities.splice(i,1); score++; player.angle += 0.2; }
                }
            });
        }

        function updateFly() {
            player.vel += player.gravity; player.y += player.vel;
            drawFancyPrincess(ctx, player.x, player.y, 30);
            if (frame % 60 === 0) entities.push({ x: canvas.width, y: Math.random() * (canvas.height - 100), w: 30, h: 100 });
            entities.forEach((p, i) => {
                p.x -= 3 + score/5;
                ctx.fillStyle = '#555'; ctx.fillRect(p.x, 0, p.w, p.y); ctx.fillRect(p.x, p.y + p.h, p.w, canvas.height);
                if (player.x + 20 > p.x && player.x < p.x + p.w && (player.y < p.y || player.y + 20 > p.y + p.h)) gameOver("CRASH !", "Trop d'obstacles...");
                if (p.x < -30) { entities.splice(i,1); score++; }
            });
            if (player.y > canvas.height || player.y < 0) gameOver("TOMBER !", "Reviens vers moi...");
        }

        function updateSpeed() {
            player.current = (player.current + player.speed) % (Math.PI * 2);
            ctx.strokeStyle = '#333'; ctx.lineWidth = 10; ctx.beginPath(); ctx.arc(canvas.width/2, canvas.height/2, 60, 0, 7); ctx.stroke();
            ctx.strokeStyle = varProp('--gold'); ctx.beginPath(); ctx.arc(canvas.width/2, canvas.height/2, 60, player.target - 0.2, player.target + 0.2); ctx.stroke();
            ctx.fillStyle = '#ff0000'; 
            let px = canvas.width/2 + Math.cos(player.current)*60;
            let py = canvas.height/2 + Math.sin(player.current)*60;
            ctx.fillText("üíã", px-10, py+10);
            drawFancyPrincess(ctx, canvas.width/2 - 20, canvas.height/2 - 20, 40);
        }

        function updateJump() {
            player.velY += 0.2; player.y += player.velY; player.x += player.velX;
            drawFancyPrincess(ctx, player.x, player.y, 30);
            if (player.x < 0) player.x = canvas.width; if (player.x > canvas.width) player.x = 0;
            entities.forEach(p => {
                ctx.fillStyle = '#00ff00'; ctx.fillRect(p.x, p.y, p.w, 10);
                if (player.velY > 0 && player.x + 20 > p.x && player.x < p.x + p.w && player.y + 30 > p.y && player.y + 30 < p.y + 15) {
                    player.velY = -8; score++;
                }
                p.y += 1 + score/20;
                if (p.y > canvas.height) { p.y = 0; p.x = Math.random()*canvas.width; }
            });
            if (player.y > canvas.height) gameOver("CHUTE !", "Je te rattraperai toujours.");
        }

        function updateMaze() {
            drawFancyPrincess(ctx, player.x, player.y, 25);
            ctx.fillStyle = '#00ff00'; ctx.fillText("EXIT", canvas.width-60, canvas.height-20);
            if (player.x > canvas.width - 60 && player.y > canvas.height - 40) {
                score = 100; gameOver("BRAVO !", "Rien ne nous s√©pare.");
            }
        }

        function varProp(name) { return getComputedStyle(document.documentElement).getPropertyValue(name); }
    </script>
</body>
</html>
